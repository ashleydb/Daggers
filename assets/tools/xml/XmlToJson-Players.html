<html>
    <head>
        <title> XML/JSON - Tests </title>
        <script src="//code.jquery.com/jquery-1.11.1.min.js"></script>
        <script src="filenames-players.js">
            // TODO: These filenames would ideally be scanned from some directory... or find a way to generate filenames.js? Include year & month sub directories? Want to POST below in some structure, e.g. news{2017:{12:{abc:{headline:"", ...}}, 11: {...}, ...}, 2016:...}
        </script>
        <script type="text/javascript">

            // Convert XML string to JSON string
            function xml2json(xml, tab) {
                var X = {
                    toObj: function(xml) {
                        var o = {};
                        if (xml.nodeType==1) {   // element node ..
                            if (xml.attributes.length)   // element with attributes  ..
                                for (var i=0; i<xml.attributes.length; i++)
                                    o["@"+xml.attributes[i].nodeName] = (xml.attributes[i].nodeValue||"").toString();
                            if (xml.firstChild) { // element has child nodes ..
                                var textChild=0, cdataChild=0, hasElementChild=false;
                                for (var n=xml.firstChild; n; n=n.nextSibling) {
                                    if (n.nodeType==1) hasElementChild = true;
                                    else if (n.nodeType==3 && n.nodeValue.match(/[^ \f\n\r\t\v]/)) textChild++; // non-whitespace text
                                    else if (n.nodeType==4) cdataChild++; // cdata section node
                                }
                                if (hasElementChild) {
                                    if (textChild < 2 && cdataChild < 2) { // structured element with evtl. a single text or/and cdata node ..
                                        X.removeWhite(xml);
                                        for (var n=xml.firstChild; n; n=n.nextSibling) {
                                            if (n.nodeType == 3)  // text node
                                                o["#text"] = X.escape(n.nodeValue);
                                            else if (n.nodeType == 4)  // cdata node
                                                o["#cdata"] = X.escape(n.nodeValue);
                                            else if (o[n.nodeName]) {  // multiple occurence of element ..
                                                if (o[n.nodeName] instanceof Array)
                                                    o[n.nodeName][o[n.nodeName].length] = X.toObj(n);
                                                else
                                                    o[n.nodeName] = [o[n.nodeName], X.toObj(n)];
                                            }
                                            else  // first occurence of element..
                                                o[n.nodeName] = X.toObj(n);
                                        }
                                    }
                                    else { // mixed content
                                        if (!xml.attributes.length)
                                            o = X.escape(X.innerXml(xml));
                                        else
                                            o["#text"] = X.escape(X.innerXml(xml));
                                    }
                                }
                                else if (textChild) { // pure text
                                    if (!xml.attributes.length)
                                        o = X.escape(X.innerXml(xml));
                                    else
                                        o["#text"] = X.escape(X.innerXml(xml));
                                }
                                else if (cdataChild) { // cdata
                                    if (cdataChild > 1)
                                        o = X.escape(X.innerXml(xml));
                                    else
                                        for (var n=xml.firstChild; n; n=n.nextSibling)
                                            o["#cdata"] = X.escape(n.nodeValue);
                                }
                            }
                            if (!xml.attributes.length && !xml.firstChild) o = null;
                        }
                        else if (xml.nodeType==9) { // document.node
                            o = X.toObj(xml.documentElement);
                        }
                        else
                            alert("unhandled node type: " + xml.nodeType);
                        return o;
                    },
                    toJson: function(o, name, ind) {
                        var json = name ? ("\""+name+"\"") : "";
                        if (o instanceof Array) {
                            for (var i=0,n=o.length; i<n; i++)
                                o[i] = X.toJson(o[i], "", ind+"\t");
                            json += (name?":[":"[") + (o.length > 1 ? ("\n"+ind+"\t"+o.join(",\n"+ind+"\t")+"\n"+ind) : o.join("")) + "]";
                        }
                        else if (o == null)
                            json += (name&&":") + "null";
                        else if (typeof(o) == "object") {
                            var arr = [];
                            for (var m in o)
                                arr[arr.length] = X.toJson(o[m], m, ind+"\t");
                            json += (name?":{":"{") + (arr.length > 1 ? ("\n"+ind+"\t"+arr.join(",\n"+ind+"\t")+"\n"+ind) : arr.join("")) + "}";
                        }
                        else if (typeof(o) == "string")
                            json += (name&&":") + "\"" + o.toString() + "\"";
                        else
                            json += (name&&":") + o.toString();
                        return json;
                    },
                    innerXml: function(node) {
                        var s = ""
                        if ("innerHTML" in node)
                            s = node.innerHTML;
                        else {
                            var asXml = function(n) {
                                var s = "";
                                if (n.nodeType == 1) {
                                    s += "<" + n.nodeName;
                                    for (var i=0; i<n.attributes.length;i++)
                                        s += " " + n.attributes[i].nodeName + "=\"" + (n.attributes[i].nodeValue||"").toString() + "\"";
                                    if (n.firstChild) {
                                        s += ">";
                                        for (var c=n.firstChild; c; c=c.nextSibling)
                                            s += asXml(c);
                                        s += "</"+n.nodeName+">";
                                    }
                                    else
                                        s += "/>";
                                }
                                else if (n.nodeType == 3)
                                    s += n.nodeValue;
                                else if (n.nodeType == 4)
                                    s += "<![CDATA[" + n.nodeValue + "]]>";
                                return s;
                            };
                            for (var c=node.firstChild; c; c=c.nextSibling)
                                s += asXml(c);
                        }
                        return s;
                    },
                    escape: function(txt) {
                        return txt.replace(/[\\]/g, "\\\\")
                            .replace(/[\"]/g, '\\"')
                            .replace(/[\n]/g, '\\n')
                            .replace(/[\r]/g, '\\r');
                    },
                    removeWhite: function(e) {
                        e.normalize();
                        for (var n = e.firstChild; n; ) {
                            if (n.nodeType == 3) {  // text node
                                if (!n.nodeValue.match(/[^ \f\n\r\t\v]/)) { // pure whitespace text node
                                    var nxt = n.nextSibling;
                                    e.removeChild(n);
                                    n = nxt;
                                }
                                else
                                    n = n.nextSibling;
                            }
                            else if (n.nodeType == 1) {  // element node
                                X.removeWhite(n);
                                n = n.nextSibling;
                            }
                            else                      // any other node
                                n = n.nextSibling;
                        }
                        return e;
                    }
                };
                if (xml.nodeType == 9) // document node
                    xml = xml.documentElement;
                var json = X.toJson(X.toObj(X.removeWhite(xml)), xml.nodeName, "\t");
                return "{\n" + tab + (tab ? json.replace(/\t/g, tab) : json.replace(/\t|\n/g, "")) + "\n}";
            }

            // Helper to show the results to the screen
            function show(s) {
                document.getElementById("out").innerHTML += (s+",\n").replace(/£/g, "&pound;").replace(/&/g, "&amp;")
                    .replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\n/g, "<br/>");
            }
            
            // Send the player to our server to store in the DB. Returns the story with an ID.
            function postPlayer(player) {
                // TODO: Must set this token first, from a login command
                //var token = '';
                var token = 'eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJleHAiOjE0OTY4MDQ5ODMwMjEsInVzZXJuYW1lIjoiYWRtaW4ifQ.09C6eUgub7IzXNQ1MdatSudv6P5kC8embK8r7VQaiUc';
                
                return new Promise(
                    // The resolver function is called with the ability to resolve or reject the promise
                    function(resolve, reject) {
                        try {
                            //if (story.story.length == 0 || story.story.length > 100000)
                            //    console.log("DEBUG: Story headline and Length=", story.story.length, story.headline);

                            if (token === '') {
                                reject("WARN: Token not set, player not posted to server.");
                            } else {
                                $.ajax({
                                    url: '/api/v1/players',
                                    method: 'POST',
                                    headers: {'x-access-token': token},
                                    data: player,
                                    dataType: 'json',
                                    success: function(res) {
                                        console.log("Player saved: ", res);

                                        // TODO: 'this' doesn't exist
                                        //this.data.id = res.data.id;
                                        // Return the story with an ID
                                        //resolve(this.data);

                                        resolve(res.id);
                                    },
                                    error: function(xhr) {
                                        console.log(`Error posting player: ${this.data}`);
                                        reject(`${xhr.statusCode()} ${xhr.statusText} ${xhr.responseText}`);
                                    }
                                });
                            }
                        } catch(e) {
                            // try failed
                            reject(e);
                        }
                    }        
                );  
            };

            // Parse each XML file from filenames.js, convert to JSON, show on screen and upload to server
            function startConverting() {
                
                // Will gather all of the json here, (but will be filled asyncronously)
                var jsonOutput = [];
                
                // Filter duplicate values out of the array
                Array.prototype.unique = function() {
                    var self = this;
                    return self.filter(function(v, i) {
                        return (self.indexOf(v) == i)
                    });
                };
                window.filenames = window.filenames.unique();
                
                // Loop over window.filenames[] and save the results
                for (i = 0; i < window.filenames.length; ++i) {
                    var xmlFileName = "players/" + window.filenames[i];
                    
                    // Load our XML file
                    $.ajax({
                        url: xmlFileName,
                        dataType: 'xml',
                        success: function(xmlData) {
                            // Got the XML as a string, now convert to JSON
                            var jsonString = xml2json(xmlData, "  ");
                            var jsonObj = JSON.parse(jsonString);

                            if (jsonObj.Profile.status != 'Active') {
                               console.log('WARN: Player is inactive');
                               return;
                            }

                            // Check what kind of image path we have and clean it up
                            //  <player_profile_image>/cms_images//player/jake-howellspitch292-3539074_231x264.jpg</player_profile_image>
                            //  <player_profile_image>/cms_images//scott-doe292-3219563_231x264.JPG</player_profile_image>
                            //  <player_profile_image>/cms_images/frankie-raymond292-2591551_231x264.jpg</player_profile_image>
                            var imageName = null;
                            if (jsonObj.Profile.player_profile_image) {
                                var oldImage = jsonObj.Profile.player_profile_image;
                                var index = oldImage.indexOf('/cms_images//player/');
                                if (index == -1) {
                                    // Not found. Check if it is not in a folder, (no other '/' characters in the string, e.g. '/cms_images/hospitlityspecialty-86292-3318061_478x359.jpg')
                                    index = oldImage.indexOf('/cms_images//');
                                    if (index == -1) {
                                        // Not found, (e.g. '/cms_images/frankie-raymond292-2591551_231x264.jpg')
                                        imageName = oldImage.replace('/cms_images/', '/player/');
                                    } else {
                                        // Remove '/cms_images//', (e.g. '/cms_images//scott-doe292-3219563_231x264.JPG')
                                        imageName = oldImage.replace('/cms_images//', '/player/');
                                    }
                                } else {
                                    // Found, so remove '/cms_images/' and add '/news', (e.g. '/cms_images//player/jake-howellspitch292-3539074_231x264.jpg')
                                    imageName = oldImage.replace('/cms_images//player/', '/player/');
                                }
                            } else {
                                console.log("Player has no image: " + this.url);
                            }

                            var dob = null;
                            if (jsonObj.Profile.date_of_birth) {
                                // Need to convert "2017-03-02 16:30:00 PM" to "2017 Mar 02 16:30:00"
                                var dateComponents = jsonObj.Profile.date_of_birth.split(' ');
                                var yMD = dateComponents[0].split('-');
                                var month;
                                switch (yMD[1]) {
                                    case '01':
                                        month = 'Jan';
                                        break;
                                    case '02':
                                        month = 'Feb';
                                        break;
                                    case '03':
                                        month = 'Mar';
                                        break;
                                    case '04':
                                        month = 'Apr';
                                        break;
                                    case '05':
                                        month = 'May';
                                        break;
                                    case '06':
                                        month = 'Jun';
                                        break;
                                    case '07':
                                        month = 'Jul';
                                        break;
                                    case '08':
                                        month = 'Aug';
                                        break;
                                    case '09':
                                        month = 'Sep';
                                        break;
                                    case '10':
                                        month = 'Oct';
                                        break;
                                    case '11':
                                        month = 'Nov';
                                        break;
                                    case '12':
                                        month = 'Dec';
                                        break;
                                }
                                var dateString = yMD[0] + ' ' + month + ' ' + yMD[2] + ' ' + dateComponents[1];

                                // Then convert to milliseconds since epoch
                                dob = Date.parse(dateString);
                            }

                            // Now reformat to fit our new site
                            var playerObj = {
                                "first_name": jsonObj.Profile.first_name, //Scott
                                "last_name": jsonObj.Profile.last_name, //Doe
                                "date_of_birth": dob, //jsonObj.Profile.date_of_birth, //milliseconds since epoch
                                "image": imageName, //jsonObj.Profile.player_profile_image, ///cms_images//scott-doe292-3219563_231x264.JPG - imageName
                                "shirt_number": Number(jsonObj.Profile.shirt_number), //4
                                "position": jsonObj.Profile.position, //Defender
                                "short_description": jsonObj.Profile.short_description, //Kit sponsored by Haines Watts
                                "biography": jsonObj.Profile.biography["#cdata"], //<![CDATA[ ...some html
                                "height": jsonObj.Profile.height, //1.85 Metres
                                "weight": jsonObj.Profile.weight, //77 Kilograms
                                "nationality": jsonObj.Profile.nationality, //English
                                "onloan_status": jsonObj.Profile.onloan_status, //No
                                "status": jsonObj.Profile.status, //Active

                                "team": 'First' // First team, Academy, etc.

                                // jsonObj.Profile.biography_date, //2012-08-16 13:04:00 PM
                                // jsonObj.Profile.fact_description,
                                // jsonObj.Profile.player_gallery,
                                // jsonObj.Profile.twitter_account,
                                // jsonObj.Profile.staff,
                                // jsonObj.Profile.featured_status, //Yes
                                // jsonObj.Profile.player_id, //384770
                                // jsonObj.Profile.taxonomy_value
                            }

                            // Send to server here. Will get back a story with an ID.
                            postPlayer(playerObj)
                            .then((player) => {
                                // Success. Player with IDs.
                                
                                // Output the results to the screen
                                show( JSON.stringify(player) );
                                // Collecting all JSON data in an array too, if we want it
                                jsonOutput.push(player);
                            }).catch((error) => {
                                // Errors. Player with no IDs.
                                console.log("ERR: postPlayer() failed:", error);
                                
                                // Output the results to the screen
                                show( JSON.stringify(playerObj) );
                                // Collecting all JSON data in an array too, if we want it
                                jsonOutput.push(playerObj);
                            });
                        },
                        error: function(xhr) {
                            console.log("Error getting XML file: " + this.url);
                        }
                    });
                }
            };

            function uploadJson() {
                var playersJson = [
                    {
                        "first_name":"Scott",
                        "last_name":"Doe",
                        "date_of_birth":594806400000,
                        "image":"/player/scott-doe292-3219563_231x264.JPG",
                        "shirt_number":"4",
                        "position":"Defender",
                        "short_description":"Kit sponsored by Haines Watts",
                        "biography":"<strong >Boots Sponsored by: Jacob Long\n<br /></strong><br  />\nDefender Scott Doe began his career as a youth at Swindon Town.\n<br  /><br  />\nHe joined Weymouth in the 2007 close season and won the Clubs player of the year award. He has one England C cap to his name after representing the side in the game against Malta in 2008.\n<br  /><br  />\nWith all the financial troubles at the Terra's he was released from contract and John Still beat off a lot of competition acquire to his signature in March 2009. He spent the last couple of months of the 2008/9 season at Kettering Town before making his first appearance for the Daggers at Crewe on the opening day of the 2009/10 season.\n<br  /><br  />\nThe assured centre back was a regular for the club making over 200 Football League appearances before being released at the end of the 2014/5 season. After a season at Boreham Wood he was re-signed by the Daggers in May 2016.\n<br  />",
                        "height":"1.85 Metres",
                        "weight":"77 Kilograms",
                        "nationality":"English",
                        "onloan_status":"No",
                        "status":"Active",
                        "team":"First"
                    },{
                        "first_name":"Luke",
                        "last_name":"Howell",
                        "date_of_birth":536832000000,
                        "image":"/player/luke-howell292-3219557_231x264.JPG",
                        "shirt_number":"7",
                        "position":"Midfielder",
                        "short_description":"Kit sponsored by Grant Moody",
                        "biography":"Luke began his career at Gillingham where he made one League appearance before moving to MK Dons in the summer of 2007.\n<br /><br />\nHe made 53 appearances for the Buckinghamshire side over four seasons, scoring once in the victory over Hereford in 2008. He joined Lincoln City, initially on loan, then on a short term deal in the January 2011 transfer window and played seventeen times for the Imps.\n<br /><br />\nDuring his career he has also played on loan for Folkestone Invicta and Welling United. He joined the Daggers in August 2011 but his first year saw him suffer a serious knee injury at Hereford in September which kept him out for six months.\n<br /><br />\nHe was the Daggers 2012/3 season top-scorer and completed over a century of Football League appearances for the Daggers before being released at the end of the 2014/5 season. After a season at Boreham Wood, along with Scott Doe, he was re-signed by the Daggers in May 2016.\n<br />",
                        "height":"1.8 Metres",
                        "weight":"66 Kilograms",
                        "nationality":"English",
                        "onloan_status":"No",
                        "status":"Active",
                        "team":"First"
                    },{
                        "first_name":"Frankie",
                        "last_name":"Raymond",
                        "date_of_birth":722073600000,
                        "image":"/player/frankie-raymond292-2591551_231x264.jpg",
                        "shirt_number":"8",
                        "position":"Midfielder",
                        "short_description":"Kit sponsored by Frances East",
                        "biography":"<strong >Boots Sponsored by: Archie Hughes\n<br /></strong><br  />\nFrankie joined the Daggers from Eastbourne Borough for an undisclosed fee in July 2014.\n<br  /><br  />\nThe 21-year-old started his career with Championship side Reading, though never made a first team appearance for the Royals.\n<br  /><br  />\nHe then had a spell in the development team at Gillingham before joining the Priory Lane side in September 2012. After making his Daggers debut in a Capital One Cup tie against Brentford, Frankie returned on loan to Eastbourne Borough in December 2015 spell to keep match fit.\n<br  /><br  />\nHe made his Football League debut for the Club in April 2015 at Newport, scoring in his season appearance against Accrington Stanley a week later.",
                        "height":"1.78 Metres",
                        "weight":null,
                        "nationality":"English",
                        "onloan_status":"No",
                        "status":"Active",
                        "team":"First"
                    },{
                        "first_name":"Andre",
                        "last_name":"Boucaud",
                        "date_of_birth":466239600000,
                        "image":"/player/andre-boucaud292-3219564_231x264.JPG",
                        "shirt_number":"17",
                        "position":"Midfielder",
                        "short_description":"Kit sponsored by Tony Payne",
                        "biography":"Andre joined the Daggers in July 2014 and made over 40 appearances for the Club in his first season.\n<br  /><br  />\nThe experienced 29-year-old started his career with Queens Park Rangers in their youth system, but he later joined Reading FC after the Hoops lost their Academy status.\n<br  /><br  />\nWhilst with the Royals he had a loan spell at Peterborough United before joining on a permanent basis. He spent two seasons at the Posh including a loan to Aldershot Town then joined Kettering Town for two spells either side of a period at Wycombe Wanderers.\n<br  /><br  />\nMoves to York City and Luton Town were followed by a transfer to Notts County where he spent two seasons. <!--[if gte mso 9]><xml>\n <w:WordDocument>\n  <w:View>Normal</w:View>\n  <w:Zoom>0</w:Zoom>\n  <w:TrackMoves/>\n  <w:TrackFormatting/>\n  <w:PunctuationKerning/>\n  <w:ValidateAgainstSchemas/>\n  <w:SaveIfXMLInvalid>false</w:SaveIfXMLInvalid>\n  <w:IgnoreMixedContent>false</w:IgnoreMixedContent>\n  <w:AlwaysShowPlaceholderText>false</w:AlwaysShowPlaceholderText>\n  <w:DoNotPromoteQF/>\n  <w:LidThemeOther>EN-GB</w:LidThemeOther>\n  <w:LidThemeAsian>X-NONE</w:LidThemeAsian>\n  <w:LidThemeComplexScript>X-NONE</w:LidThemeComplexScript>\n  <w:Compatibility>\n   <w:BreakWrappedTables/>\n   <w:SnapToGridInCell/>\n   <w:WrapTextWithPunct/>\n   <w:UseAsianBreakRules/>\n   <w:DontGrowAutofit/>\n   <w:SplitPgBreakAndParaMark/>\n   <w:EnableOpenTypeKerning/>\n   <w:DontFlipMirrorIndents/>\n   <w:OverrideTableStyleHps/>\n  </w:Compatibility>\n  <m:mathPr>\n   <m:mathFont m:val=\"Cambria Math\"/>\n   <m:brkBin m:val=\"before\"/>\n   <m:brkBinSub m:val=\"&#45;-\"/>\n   <m:smallFrac m:val=\"off\"/>\n   <m:dispDef/>\n   <m:lMargin m:val=\"0\"/>\n   <m:rMargin m:val=\"0\"/>\n   <m:defJc m:val=\"centerGroup\"/>\n   <m:wrapIndent m:val=\"1440\"/>\n   <m:intLim m:val=\"subSup\"/>\n   <m:naryLim m:val=\"undOvr\"/>\n  </m:mathPr></w:WordDocument>\n</xml><![endif]--><span style=\"font-size:9.0pt;font-family:&quot;Arial&quot;,sans-serif; mso-bidi-font-weight:bold\" >The midfielder also has over 30 international caps for Trinidad and Tobago, scoring the first of his two goals in a 3-1 win over Saudi Arabia.</span>",
                        "height":"1.73 Metres",
                        "weight":"71 Kilograms",
                        "nationality":"English",
                        "onloan_status":"No",
                        "status":"Active",
                        "team":"First"
                    },{
                        "first_name":"Mark",
                        "last_name":"Cousins",
                        "date_of_birth":537177600000,
                        "image":"/player/mark-cousins292-3219560_231x264.JPG",
                        "shirt_number":"30",
                        "position":"Goalkeeper",
                        "short_description":"Kit sponsored by John East",
                        "biography":"<strong >Boots Sponsored by: Jacob Stammers\n<br /></strong><br  />\nAfter starting his career as a schoolboy at Fulham, Mark progressed through the Colchester United ranks to their first team having joined on a scholarship.\n<br  /><br  />\nFollowing a work experience spell at Whitton Town he made his Football League debut for the U’s against Barnsley as a substitute in August 2007.\n<br  /><br  />\nFurther work experience spells followed at Staines Town, Enfield Town and Yeading then in July 2012 Mark was awarded the number one shirt at Colchester.\n<br  /><br  />\nHe went on to play 58 games for the U’s before joining the Daggers in June 2014 when his contract expired. Mark took over between the sticks in October and made 37 appearances last season, finishing runner-up in the clubs end of season awards.",
                        "height":"1.85 Metres",
                        "weight":"71 Kilograms",
                        "nationality":"English",
                        "onloan_status":"No",
                        "status":"Active",
                        "team":"First"
                    },{
                        "first_name":"Joe",
                        "last_name":"Widdowson",
                        "date_of_birth":607161600000,
                        "image":"/player/joe-widdowson292-3219575_231x264.JPG",
                        "shirt_number":"3",
                        "position":"Defender",
                        "short_description":"Joe joined the Daggers at the end of November, initially on a month’s loan from Bury, before making it permanent in January. ",
                        "biography":"He made his Daggers debut in the home game with Tranmere in December 2014 and finished last season with 18 appearances for the Club. The 25-year-old signed for the Shakers at the start of the 2014/5 season, before being loaned to fellow League Two side Morecambe for two months.\n<br  /><br  />\nJoe is a product of West Ham United’s Academy and comes with a wealth of Football League experience, having made over 120 appearances for Rotherham United, Grimsby Town, Rochdale and Northampton Town.\n<br  /><br  />\nTo sponsor a players kit click here: <a href=\"http://www.daggers.co.uk/commercial/player_kit_sponsorship/\" >http://www.daggers.co.uk/commercial/player_kit_sponsorship/</a><br  />",
                        "height":"1.828 Metres",
                        "weight":"76.2 Kilograms",
                        "nationality":"English",
                        "onloan_status":"No",
                        "status":"Active",
                        "team":"First"
                    },{
                        "first_name":"Scott",
                        "last_name":"Mitchell",
                        "date_of_birth":904633200000,
                        "image":null,
                        "shirt_number":"34",
                        "position":"Midfielder",
                        "short_description":"Scott was handed the number 27 shirt ahead of the Club’s game at Yeovil in October 2015",
                        "biography":"The young defender has been with the Clubs’ Academy for six years and was captain of the U16s last season.",
                        "height":null,
                        "weight":null,
                        "nationality":"English",
                        "onloan_status":"No",
                        "status":"Active",
                        "team":"First"
                    },{
                        "first_name":"Oliver",
                        "last_name":"Hawkins",
                        "date_of_birth":702716400000,
                        "image":"/player/oliver-hawkins292-3219562_231x264.JPG",
                        "shirt_number":"12",
                        "position":"Striker",
                        "short_description":"Kit sponsored by Paul Gwinn",
                        "biography":"Oliver joined the Daggers for a record transfer fee in January 2016.\n<br />He began his career at North Greenford United, but it was at Hillingdon Borough where he really began to break through during the 2010/11 season. He followed the manager to Northwood in March 2011 and finished top scorer two seasons running.\n<br />Unsurprisingly Hawkins' excellent form attracted the attention of clubs at higher levels, and the striker duly signed for Hemel Hempstead Town in the summer of 2013. The tall striker spent time at Harrow Borough, before returning and establishing himself as a regular for the Tudors.\n<br />He made his Daggers debut in the home game against Northampton Town in January, scoring his first goal a couple of weeks later at Mansfield Town.<br />\nTo sponsor a players kit click here: <a href=\"http://www.daggers.co.uk/commercial/player_kit_sponsorship/\">http://www.daggers.co.uk/commercial/player_kit_sponsorship/</a>",
                        "height":null,
                        "weight":null,
                        "nationality":"English",
                        "onloan_status":"No",
                        "status":"Active",
                        "team":"First"
                    },{
                        "first_name":"Luke",
                        "last_name":"Guttridge",
                        "date_of_birth":386064000000,
                        "image":"/player/luke-guttridge292-3219556_231x264.JPG",
                        "shirt_number":"10",
                        "position":"Midfielder",
                        "short_description":"Kit sponsored by Roz Threadgold",
                        "biography":"Luke joined Northampton in August 2008 and made 100 appearances for the Cobblers with a two-year spell at Aldershot Town sandwiched between his first and last appearance.\n<br />He moved to Luton Town in July 2013 and was instrumental in helping the Hatters win promotion back to the Football League scoring 13 goals and assisting 9 others in 32 league games.<br />Luke signed for the Daggers during the January transfer window in 2016.",
                        "height":"1.73 Metres",
                        "weight":"67.2 Kilograms",
                        "nationality":"English",
                        "onloan_status":"No",
                        "status":"Active",
                        "team":"First"
                    },{
                        "first_name":"Craig",
                        "last_name":"Robson",
                        "date_of_birth":681116400000,
                        "image":"/player/craig-robson292-3219566_231x264.JPG",
                        "shirt_number":"5",
                        "position":"Defender",
                        "short_description":"Kit sponsored by Pat Andrews",
                        "biography":"Craig began his career at Havant &amp; Waterlooville and then spent two years in Western Australia playing semi-professionally for Sorrento FC before joining Bognor Regis Town during the summer of 2013.\n<br  /><br  />\nThe 24-year old played over 150 games for the Nyewood Lane side and impressed John Still enough in the games he watched him play to earn a 2-year Daggers contract in the close season.\n<br  />",
                        "height":null,
                        "weight":null,
                        "nationality":"English",
                        "onloan_status":"No",
                        "status":"Active",
                        "team":"First"
                    },{
                        "first_name":"Luke",
                        "last_name":"Pennell",
                        "date_of_birth":822643200000,
                        "image":"/player/luke-pennell292-3219558_231x264.JPG",
                        "shirt_number":"16",
                        "position":"Defender",
                        "short_description":"Centre half, Luke, joined the Daggers from Dunstable in April 2016. ",
                        "biography":"",
                        "height":"1.9 Metres",
                        "weight":null,
                        "nationality":"English",
                        "onloan_status":"No",
                        "status":"Active",
                        "team":"First"
                    },{
                        "first_name":"Josh",
                        "last_name":"Staunton",
                        "date_of_birth":811148400000,
                        "image":"/player/josh-staunton292-3219578_231x264.JPG",
                        "shirt_number":"32",
                        "position":"Defender",
                        "short_description":"Kit sponsored by Ray Calcutt",
                        "biography":"Josh signed for the Daggers during the 2016 close season after being released by Charlton Athletic.\n<br  /><br  />\nHe began his career at Gillingham, which included a spell on loan at Maidstone United, then joined the Addicks a year ago.\n<br  /><br  />\nHe was a regular at the heart of their U21s’ defence bagging two goals and wearing the captain’s armband on a number of occasions. He also had a spell on loan at St Albans City where he made seven appearances.\n<br  /><br  />\nTo sponsor a players kit click here: <a href=\"http://www.daggers.co.uk/commercial/player_kit_sponsorship/\" >http://www.daggers.co.uk/commercial/player_kit_sponsorship/</a><br  />",
                        "height":"1.79 Metres",
                        "weight":null,
                        "nationality":"English",
                        "onloan_status":"No",
                        "status":"Active",
                        "team":"First"
                    },{
                        "first_name":"Curtley",
                        "last_name":"Williams",
                        "date_of_birth":637833600000,
                        "image":"/player/curtley-williams292-3219567_231x264.JPG",
                        "shirt_number":"2",
                        "position":"Defender",
                        "short_description":"Kit sponsored by Mark Odams",
                        "biography":"Right-back Williams came through the youth ranks at Ipswich Town before joining the Glenn Hoddle Academy in Spain.\n<br  /><br  />\nHaving impressed whilst at the former England manager’s set-up, he then had a short spell at Chelmsford City before signing for Lowestoft Town in 2012/13.\n<br  /><br  />\nThe 26-year old made 23 league appearances for the Trawler Boys in his first season and was part of the team that lost the play-off final to Concord Rangers.\n<br  /><br  />\nA year later he was instrumental in his side gaining play-off promotion to the Conference North. His form attracted John Still to make him his first signing after the Hatters won promotion back to the Football League in 2014. But after an impressive start to the season, injury hampered his progress at Kenilworth Road and he was one of a number of players released by the Hatters in May 2016 before being snapped up by the Daggers on a one-year deal.\n<br  /><br  /><br  />",
                        "height":"1.82 Metres",
                        "weight":"75 Kilograms",
                        "nationality":"English",
                        "onloan_status":"No",
                        "status":"Active",
                        "team":"First"
                    },{
                        "first_name":"Elliot",
                        "last_name":"Justham",
                        "date_of_birth":648284400000,
                        "image":"/player/elliot-justham292-3219569_231x264.JPG",
                        "shirt_number":"1",
                        "position":"Goalkeeper",
                        "short_description":"Kit sponsored by Jacob Collins",
                        "biography":"<strong >Boots Sponsored by: Jacob Collins</strong><br  /><br  />\nElliot Justham joined the Daggers after being released by Luton at the end of the 2015/6 season.\n<br  /><br  />\nHe joined Luton Town in May 2013 having played previously for Waltham Forest, Leyton, Redbridge, Brentwood Town and East Thurrock United.\n<br  /><br  />\nHe made his Football League debut for the Hatters at AFC Wimbledon in February 2014 and kept his place for the remainder of that season having been a regular on the bench during the previous season during Town’s Conference title campaign.\n<br  /><br  />\nHe made 17 appearances in all competitions last season.\n<br  /><br  /><br  />",
                        "height":"1.9 Metres",
                        "weight":"79 Kilograms",
                        "nationality":"English",
                        "onloan_status":"No",
                        "status":"Active",
                        "team":"First"
                    },{
                        "first_name":"Matt",
                        "last_name":"Robinson",
                        "date_of_birth":770454000000,
                        "image":"/player/matt-robinson292-3219561_231x264.JPG",
                        "shirt_number":"6",
                        "position":"Midfielder",
                        "short_description":"Kit sponsored by Nathan Collins.",
                        "biography":"Midfielder Robinson began his career as a youth player in the Leicester City academy before joining Luton Town in 2012.\n<br /><br />\nHe went on to play 47 games for the Hatters including 27 starts in their Conference Premier title success of 2013/14. He made his Football League debut in August 2014 as Luton beat Carlisle United 1-0.\n<br /><br />\nMatt has also had spells at Kidderminster Harriers, Grimsby Town and Woking, with whom he played 25 games last season. In May 2016 he was released from his contract by mutual consent and joined the Daggers.\n<br /><br />To sponsor a players kit click here: <a href=\"http://www.daggers.co.uk/commercial/player_kit_sponsorship/\" >http://www.daggers.co.uk/commercial/player_kit_sponsorship/</a><br  />",
                        "height":"1.88 Metres",
                        "weight":"80 Kilograms",
                        "nationality":"English",
                        "onloan_status":"No",
                        "status":"Active",
                        "team":"First"
                    },{
                        "first_name":"Fejiri",
                        "last_name":"Okenabirhie",
                        "date_of_birth":825235200000,
                        "image":"/player/fejire-okenabirhe292-3219570_231x264.JPG",
                        "shirt_number":"11",
                        "position":"Striker",
                        "short_description":"Kit sponsored by Maria Thompson",
                        "biography":"Fejiri, 20, joined the Daggers in June 2016. The striker started his youth career at Arsenal before signing his first professional deal at Stevenage in 2014.\n<br  /><br  />\nAfter several loan spells to gain experience at Bedford Town, Cambridge City, Royston Town and Farnborough he made his Football League debut for the Broadhall Way side in a League One game at Bristol City.\n<br  /><br  />\nHe was released at the end of the 2014/15 season and joined up with Millwall U21s before signing for Ryman Premier League Harrow Borough in November 2015. By the end of the season he had scored 10 goals in 23 appearances for the Boro.\n<br  />",
                        "height":"1.78 Metres",
                        "weight":null,
                        "nationality":"English",
                        "onloan_status":"No",
                        "status":"Active",
                        "team":"First"
                    },{
                        "first_name":"Jakub",
                        "last_name":"Berkowicz",
                        "date_of_birth":873615600000,
                        "image":null,
                        "shirt_number":"24",
                        "position":"Striker",
                        "short_description":"Jakub, aged 18, signed for the Daggers Academy in February 2016 and immediately impressed with his goalscoring for the under-18 side during the remainder of the season.",
                        "biography":"He signed a professional contract in June and will be looking for an opportunity to make his first team debut in the 2016/17 season.\n<br  /><br  />\nTo sponsor a players kit click here: <a href=\"http://www.daggers.co.uk/commercial/player_kit_sponsorship/\" >http://www.daggers.co.uk/commercial/player_kit_sponsorship/</a><br  />",
                        "height":null,
                        "weight":null,
                        "nationality":"English",
                        "onloan_status":"No",
                        "status":"Active",
                        "team":"First"
                    },{
                        "first_name":"Leo",
                        "last_name":"Donnellan",
                        "date_of_birth":899794800000,
                        "image":"/player/leo-donnellan292-3220114_231x264.JPG",
                        "shirt_number":"18",
                        "position":"Midfielder",
                        "short_description":"Dagenham &amp; Redbridge signed former QPR youngster Leo in June 2016.",
                        "biography":"The midfielder was a regular for the R’s youth team last season and was rewarded with a call-up to the Republic of Ireland U18's national team for the double header against the Czech Republic.\n<br  /><br  />\nYounger brother of West Brom defender Shaun, Leo ended the season on loan to Worcester City.\n<br  /><br  />\nTo sponsor a players kit click here: <a href=\"http://www.daggers.co.uk/commercial/player_kit_sponsorship/\" >http://www.daggers.co.uk/commercial/player_kit_sponsorship/</a><br  />",
                        "height":null,
                        "weight":null,
                        "nationality":"Irish",
                        "onloan_status":"No",
                        "status":"Active",
                        "team":"First"
                    },{
                        "first_name":"Corey",
                        "last_name":"Whitely",
                        "date_of_birth":679215600000,
                        "image":"/player/corey-whitelypitch292-3535531_231x264.jpg",
                        "shirt_number":"25",
                        "position":"Midfielder",
                        "short_description":"Kit sponsored Colin Everett",
                        "biography":"25 year-old Corey joined the Daggers on 8th August from Enfield Town where he has been named player of the year for the past two seasons.\n<br  /><br  />\nHe began his career as a schoolboy at Tottenham moving to Waltham Forest, Cheshunt and Enfield Town.\n<br  /><br  />\nThe quick and powerful striker/winger was named in the team of the year for the Ryman League Division One North in 2013 and Ryman League Premier Division 2015.\n<br  /><br  />\nHe scored 44 goals and has had an assist in 18 goals over the past two seasons which prompted Reading to have a look at him in April 2016.\n<br  /><br  />\nCorey turned down offers from other National League and Football League clubs to link up with the Daggers.\n<br  />",
                        "height":null,
                        "weight":null,
                        "nationality":"English",
                        "onloan_status":"No",
                        "status":"Active",
                        "team":"First"
                    },{
                        "first_name":"Paul",
                        "last_name":"Benson",
                        "date_of_birth":308559600000,
                        "image":"/player/paul-bensonpitch292-3535530_231x264.jpg",
                        "shirt_number":"14",
                        "position":"Striker",
                        "short_description":"Kit sponsored by Jonathan and Louisa Parsons ",
                        "biography":"<strong >Boots Sponsored by: Leah and Evelyn Parsons\n<br /></strong><br  />\nSouthend born Paul, was initially spotted by Dagenham &amp; Redbridge manager John Still in July 2005 playing for White Ensign of the Essex Olympian League where he scored 107 goals in 65 games.\n<br  /><br  />\nHis first year with the Daggers was interrupted by a broken leg. However, upon his return he finished as top scorer in the Conference as the Daggers won the title in 2007.\n<br  /><br  />\nHe continued to find the net in the Football League and scored the opener for the Club in the 2010 Play-Off final at Wembley against Rotherham, earning the Daggers promotion to League One.\n<br  /><br  />\nLeague One Charlton Athletic paid a six figure fee to take him to the Valley at the end of August 2010. He scored 10 goals in 27 appearances for Charlton in his first season but was transferred to Paolo Di Canio’s Swindon Town as part of a swap deal in exchange for Leon Clarke in January 2012.\n<br  /><br  />\nEleven goals in 22 appearances for the Robins helped secure the League Two title. Paul scored 2 goals in seven games on loan to Portsmouth and 4 goals in 16 for Cheltenham on loan before linking up again with John Still at Luton.\n<br  /><br  />\nHe played a key role as Luton won promotion to League Two, scoring 17 league goals and assisting 14 others throughout the 2013–14 season.\n<br  /><br  />\nAnother broken leg restricted his Football League appearances for Luton and he was released at the end of the 2015/6 season, rejoining the Daggers and John Still on 8th August 2016.\n<br  />",
                        "height":"1.86 Metres",
                        "weight":"70 Kilograms",
                        "nationality":"English",
                        "onloan_status":"No",
                        "status":"Active",
                        "team":"First"
                    },{
                        "first_name":"Sam",
                        "last_name":"Ling",
                        "date_of_birth":850809600000,
                        "image":"/player/sam-lingpitch292-3536237_231x264.jpg",
                        "shirt_number":"19",
                        "position":"Defender",
                        "short_description":null,
                        "biography":"",
                        "height":"1.75 Metres",
                        "weight":"64 Kilograms",
                        "nationality":"English",
                        "onloan_status":"No",
                        "status":"Active",
                        "team":"First"
                    },{
                        "first_name":"Jordan",
                        "last_name":"Maguire-Drew",
                        "date_of_birth":874306800000,
                        "image":"/player/maguire-drew292-3219559_231x264.JPG",
                        "shirt_number":"15",
                        "position":"Striker",
                        "short_description":"Kit sponsored by choicestore.com",
                        "biography":"Jordan initially joined the Daggers on a short term loan until 9th January back in July, and the winger extended his stay with the club until the end of the season early in January, after scoring nine goals and getting seven assists for the Daggers.\n<br />The 18-year-old is yet to make his senior debut for the Seagulls and has just moved up to the Championship club's under-21 squad.<br />He scored eight goals in six games during a loan spell at Worthing last season as the Sussex side won promotion to the Ryman League Premier Division.",
                        "height":null,
                        "weight":null,
                        "nationality":"English",
                        "onloan_status":"No",
                        "status":"Active",
                        "team":"First"
                    },{
                        "first_name":"Harvey",
                        "last_name":"Brown",
                        "date_of_birth":null,
                        "image":null,
                        "shirt_number":"35",
                        "position":"Midfielder",
                        "short_description":null,
                        "biography":"",
                        "height":null,
                        "weight":null,
                        "nationality":"English",
                        "onloan_status":"No",
                        "status":"Active",
                        "team":"First"
                    },{
                        "first_name":"Liam",
                        "last_name":"Gordon",
                        "date_of_birth":null,
                        "image":null,
                        "shirt_number":"36",
                        "position":"Defender",
                        "short_description":null,
                        "biography":"",
                        "height":null,
                        "weight":null,
                        "nationality":"English",
                        "onloan_status":"No",
                        "status":"Active",
                        "team":"First"
                    },{
                        "first_name":"Jordy",
                        "last_name":"Mongoy",
                        "date_of_birth":null,
                        "image":null,
                        "shirt_number":"37",
                        "position":"Striker",
                        "short_description":null,
                        "biography":"",
                        "height":null,
                        "weight":null,
                        "nationality":"English",
                        "onloan_status":"No",
                        "status":"Active",
                        "team":"First"
                    },{
                        "first_name":"Shaun",
                        "last_name":"Donnellan",
                        "date_of_birth":null,
                        "image":"/player/shaun-donnellanpitch292-3539075_231x264.jpg",
                        "shirt_number":"27",
                        "position":"Defender",
                        "short_description":null,
                        "biography":"The 19-year old defender is the brother of current Daggers squad member Leo and will wear squad number 27.\n<br /><br />\nThe Republic of Ireland Under-19 international has come through the ranks at The Hawthorne's and, although not playing in a first team match for the Baggies, he had a spell at Worcester City on loan last season playing alongside his Brother Leo.\n<br /><br />\nHe recently featured at the Chigwell Construction Stadium in West Brom’s Premier League 2 fixture against West Ham United; with the Baggies losing 1-2.",
                        "height":null,
                        "weight":null,
                        "nationality":"Irish",
                        "onloan_status":"Yes",
                        "status":"Active",
                        "team":"First"
                    },{
                        "first_name":"Jake",
                        "last_name":"Sheppard",
                        "date_of_birth":864975600000,
                        "image":null,
                        "shirt_number":"28",
                        "position":"Defender",
                        "short_description":null,
                        "biography":"Defender Jake Sheppard has joined the Daggers from Reading FC on a youth loan until the end of the 2016/2017 season.\n<br  />\n \n<br  />\nThe young full back signed a professional contract with Reading in July 2015 although he has yet to make a senior appearance for the club.\n<br  />\n \n<br  />\nThe Defender has had short loan spells at Hayes &amp; Yeading and Eastbourne, and featured in the FA Youth Cup last season for Reading against Arsenal.\n<br  />",
                        "height":null,
                        "weight":null,
                        "nationality":"Scottish",
                        "onloan_status":"Yes",
                        "status":"Active",
                        "team":"First"
                    },{
                        "first_name":"Ray",
                        "last_name":"Grant",
                        "date_of_birth":846835200000,
                        "image":null,
                        "shirt_number":"26",
                        "position":"Midfielder",
                        "short_description":null,
                        "biography":"",
                        "height":null,
                        "weight":null,
                        "nationality":"Scottish",
                        "onloan_status":"No",
                        "status":"Active",
                        "team":"First"
                    },{
                        "first_name":"Elliott",
                        "last_name":"Romain",
                        "date_of_birth":null,
                        "image":null,
                        "shirt_number":"9",
                        "position":"Midfielder",
                        "short_description":null,
                        "biography":"",
                        "height":null,
                        "weight":null,
                        "nationality":null,
                        "onloan_status":"No",
                        "status":"Active",
                        "team":"First"
                    }
                ];

                // Send to server here. Will get back a story with an ID.
                for (i = 0; i < playersJson.length; ++i) {
                    var playerObj = playersJson[i];

                    postPlayer(playerObj)
                    .then((player) => {
                        // Success. Player with IDs.
                        
                        // Output the results to the screen
                        show( JSON.stringify(player) );
                    }).catch((error) => {
                        // Errors. Player with no IDs.
                        console.log("ERR: postPlayer() failed:", error);
                    });
                }
            }
            
            // Copies a string to the clipboard. Must be called from within an 
            // event handler such as click. May return false if it failed, but
            // this is not always possible. Browser support for Chrome 43+, 
            // Firefox 42+, Safari 10+, Edge and IE 10+.
            // IE: The clipboard feature may be disabled by an administrator. By
            // default a prompt is shown the first time the clipboard is 
            // used (per session).
            function copyToClipboard(text) {
                if (window.clipboardData && window.clipboardData.setData) {
                    // IE specific code path to prevent textarea being shown while dialog is visible.
                    return clipboardData.setData("Text", text); 

                } else if (document.queryCommandSupported && document.queryCommandSupported("copy")) {
                    var textarea = document.createElement("textarea");
                    textarea.textContent = text;
                    textarea.style.position = "fixed";  // Prevent scrolling to bottom of page in MS Edge.
                    document.body.appendChild(textarea);
                    textarea.select();
                    try {
                        return document.execCommand("copy");  // Security exception may be thrown by some browsers.
                    } catch (ex) {
                        console.warn("Copy to clipboard failed.", ex);
                        return false;
                    } finally {
                        document.body.removeChild(textarea);
                    }
                }
            }
            
            // Will copy the json as an array of objects
            function copyJsonToClipboard() {
                console.log('Start: copyJsonToClipboard');
                var jsonRaw = document.getElementById('out').textContent;
                // Strip off the last ','
                var json = jsonRaw.substr(0, jsonRaw.length-1);
                copyToClipboard('[' + json + ']');
                console.log('Done: copyJsonToClipboard');
            }

        </script>
    </head>

    <body>
        <p>
            <b>Note:</b> Did you set "token" in postPlayer()?<br />
            If not then the data will not be stored on the server and output here will not contain IDs.
        </p>
        <button onclick="javascript:startConverting();">Start Converting XML to JSON</button>
        <button onclick="javascript:copyJsonToClipboard();">Copy JSON as Array to Clipboard</button>
        <button onclick="javascript:uploadJson();">Upload hardcoded JSON to server</button>
        <pre id="out"></pre>
    </body>
</html>
